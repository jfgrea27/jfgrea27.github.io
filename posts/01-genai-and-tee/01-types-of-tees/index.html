<!doctype html><html lang=en-uk dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://jfgrea27.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jfgrea27.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jfgrea27.github.io/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://jfgrea27.github.io/favicon/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://jfgrea27.github.io/favicon/apple-touch-icon.png><meta name=description content><title>01 - Types of TEEs | James Rea Blog</title><link rel=canonical href=https://jfgrea27.github.io/posts/01-genai-and-tee/01-types-of-tees/><meta property="og:url" content="https://jfgrea27.github.io/posts/01-genai-and-tee/01-types-of-tees/"><meta property="og:site_name" content="James Rea Blog"><meta property="og:title" content="01 - Types of TEEs"><meta property="og:description" content="A whistle stop tour of the types of TEEs."><meta property="og:locale" content="en_uk"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-26T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-26T00:00:00+00:00"><meta property="article:tag" content="Tee"><meta property="article:tag" content="Privacy"><link rel=stylesheet href=/assets/combined.min.6b2be612bd1711a94b21d7d52a9fd00b6a1c128072dcaf0171eff6b25f76344f.css media=all></head><body class=light><div class=content><header><div class=header></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a>
<span class=breadcrumbs-separator>> </span><a href=/posts/>Posts</a>
<span class=breadcrumbs-separator>> </span><a href=/posts/01-genai-and-tee/>GenAI and Trusted Execution Environments</a>
<span class=breadcrumbs-separator>> </span><a class=breadcrumbs-current href=/posts/01-genai-and-tee/01-types-of-tees/>01 - Types of TEEs</a></div><div><div class=single-intro-container><h1 class=single-title>01 - Types of TEEs</h1><p class=single-summary>A whistle stop tour of the types of TEEs.</p><p class=single-readtime><time datetime=2025-08-26T00:00:00+00:00>August 26, 2025</time></p></div><div class=single-content><p>Trusted Execution Environments are special pieces of hardware that encrypt data in-use so to prevent attackers from compromising running applications.</p><p>Hardware providers including ARM, Intel and AMD have built various TEE solutions that depend on the scope of the <a href=#trusted-computing-base><strong>Trusted Computing Base</strong></a>.</p><ul><li>Intel&rsquo;s Secure Guard Extension (SGX)</li><li>AMD Secure Encrypted Virtulization with Secure Nested Paging (SEV-SNP)</li><li>ARM TrustZone</li><li>Confidential Computing (CoCo)</li></ul><p>For the sake of scope reduction, I will only explore Intel&rsquo;s SGX, AMD&rsquo;s SEV-SNP and CoCos, going from smallest TCB to largest TCB.</p><h2 class=heading id=the-tee-zoo>The TEE Zoo
<a class=anchor href=#the-tee-zoo>#</a></h2><p>For each TEE solution, we will discuss</p><ul><li>its Architecture;</li><li>its Remote Attestation framework;</li><li>an example of a working TEE;</li><li>its use-cases.</li></ul><h3 class=heading id=intel-sgx>Intel SGX
<a class=anchor href=#intel-sgx>#</a></h3><p><strong>Architecture</strong></p><p>The SGX architecture relies on creating a reserved region of memory, the <strong>Enclave Page Cache</strong> that holds encrypted data that is protected by a hardware-derived key (the <strong>Root Sealing Key (RSK)</strong>) that only resides in a secure CPU register.
SGX also adds a set of instructions (including <code>ECREATE</code>, <code>EENTER</code>, <code>EEXIT</code>) to manage the enclave.
The <strong>Memory Encryption Engine (MEE)</strong> built into the memory controller is responsible for the encryption/decryption of the data.</p><p>No one, not even the root has access to the EPC in DRAM. Further, data is only decrypted inside the CPU, so L1/L2/L3 caches still hold encrypted data. The MEE encrypts/decrypts data on-the-fly, which has some performance overhead.</p><p>The control flow works as follows:</p><ol><li>Enclave is created using <code>ECREATE</code>;</li><li>Data is loaded using <code>EADD</code>;</li><li>Enclave is initialized using <code>EINIT</code>;</li><li>Enter the enclave using <code>EENTER</code>;</li><li>Run <em>trusted function</em>;</li><li>Exit the enclave using <code>EEXIT</code>.</li></ol><p><a href=#remove-attestation>Remote Attestation</a> in SGX is done as follows:</p><p><strong>Example - a minimal SGX enclave</strong></p><p>This example is a basic application running an enclave using the <a href=https://github.com/intel/linux-sgx>sgx-linux</a> repository.</p><p>We will assume you have installed <code>Intel SGX SDK</code> and <code>Intel SGX PSW</code>.</p><blockquote><p><strong><em>NOTE:</em></strong> I had some difficulties installing SGX Linux on my Ubuntu 24.04 box. <a href=https://codentium.com/setting-up-intel-sgx/>This article</a> was very useful</p></blockquote><p>I have created a <a href=https://github.com/jfgrea27/minimal-sgx-enclave>minimal-sgx-enclave</a> for exploring SGX internals.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>git clone git@github.com:jfgrea27/minimal-sgx-enclave.git
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># build</span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># run</span>
</span></span><span style=display:flex><span>./app
</span></span></code></pre></div><p>You have ran your first enclave!</p><p>The repository explores SGX more in depth including:</p><ul><li><a href=https://github.com/jfgrea27/minimal-sgx-enclave/blob/main/README.md#sgx-ergonomics>SGX Ergonomics</a></li><li><a href=https://github.com/jfgrea27/minimal-sgx-enclave/blob/main/README.md#assembly-calls>Assembly calls</a></li><li><a href=https://github.com/jfgrea27/minimal-sgx-enclave/blob/main/README.md#sgx-ergonomics>Remote Attestation</a></li></ul><p><strong>Discussion</strong></p><p>As we have detailed in SGX&rsquo;s architecture above, the system relies on a very small TCB that includes the CPU and its microcode. Data is always stored in EPC (encrypted), which limits SGX use-cases to small applications, although Azure do provide some of their DCdsv3 series with up to 256GiB of EPC, as noted <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/sizes/general-purpose/dcdsv3-series?tabs=sizebasic#sizes-in-series">here</a>.</p><p>It is worth noting that SGX are not fully immune.
TODO TALK ABOUT THE TYPES OF ATTACKS vulenrable to side-channel attacks - cache timing, page fault patterns.</p><p>A typical use case for using SGX Intel as TEE would be smallish applications that require small trust - for instance a cryptographic key/password store.</p><h3 class=heading id=amd-sev-snp>AMD SEV-SNP
<a class=anchor href=#amd-sev-snp>#</a></h3><p><strong>Architecture</strong></p><p><strong>Example - Deploying a TEE on a Cloud provider</strong></p><ul><li>build a simple postgres DB running in VM.</li></ul><p><strong>Discussion</strong></p><h3 class=heading id=confidential-containers>Confidential Containers
<a class=anchor href=#confidential-containers>#</a></h3><p><strong>Architecture</strong></p><p><strong>Example - K8S meets TEEs</strong></p><p><strong>Discussion</strong></p><h2 class=heading id=lexicon>Lexicon
<a class=anchor href=#lexicon>#</a></h2><h3 class=heading id=guest-vs-host-os>Guest vs Host OS
<a class=anchor href=#guest-vs-host-os>#</a></h3><p>In the context of Virtual Machines (VMs), we distinguish Guest OS running the application inside the virtualized hardware from Host OS running the hypervisor.</p><p>In Type-1 hypervisors (or <em>bare-metal hypervisor</em>), there is no such Host OS.</p><p>In Type-2 hypervisor, there is a Host OS that runs the hypervisor amongst other applications.</p><p>Most cloud providers predominantly deploy applications in VMs running <a href=https://en.wikipedia.org/wiki/Hypervisor>Type-1 hypervisor</a>, as illustrated below</p><p><figure><div><img loading=lazy alt="alt text" src=./img/hypervisor-types.svg></div><div class=caption-container><figcaption>Types of hypervisor - (Wikipedia)</figcaption></div></figure></p><p>As a contrast, if you were to run a VM on your laptop, this would be a Type-2 hypervisor as your laptop OS is running the hypervisor (and guest OS) as well as other applications (like browser, etc.).</p><h3 class=heading id=trusted-computing-base>Trusted Computing Base
<a class=anchor href=#trusted-computing-base>#</a></h3><p>The <strong>Trusted Computing Base (TCB)</strong> is the set of hardware, firmware and software components that must be trusted to enforce the security properties of a system. If any part of the TCB is <em>compromised</em>, the security guarantees of the system (e.g. TEE) can be broken.</p><p>The smaller the TCB, the less must be trusted to be secure, hence better security.</p><p>In the context of TEEs, the TCB varies depending on the type of TEE. For instance, in Intel&rsquo;s SGX, the TCB is very small including CPU, enclave runtime and enclave code, whilst for AMD SEV-SNP, the TCB is larger since the entire guest OS must be trusted.</p><p>Smaller TCB might not always make sense, especially if your application has a significant memory footprint. Please read <a href=#the-tee-zoo>The TEE Zoo</a> for details on this.</p><h3 class=heading id=remove-attestation>Remove Attestation
<a class=anchor href=#remove-attestation>#</a></h3><p>TODO</p></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>Powered by
<a href=https://gohugo.io/>Hugo</a>
and
<a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer></body><script>function isAuto(){return document.body.classList.contains("auto")}function setTheme(){if(!isAuto())return;document.body.classList.remove("auto");let e="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"),document.body.classList.add(e)}function invertBody(){document.body.classList.toggle("dark"),document.body.classList.toggle("light")}isAuto()&&window.matchMedia("(prefers-color-scheme: dark)").addListener(invertBody),setTheme()</script><script defer src=/js/copy-code.js></script></html>